<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>Hello World!</title>
        <!-- https://electronjs.org/docs/tutorial/security#csp-meta-tag -->
        <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline';" />

        <script>let $ = require('jquery');</script>
        <link rel="stylesheet" type="text/css" href="./style.css">
        <!--    -->
    </head>
    <body>
        <script type="text/javascript">
            var mysql = require('mysql');
            const fs = require('fs');


            var IP_ADDRESS, USER, PASSWORD, DATABASE_NAME;
            var CONNECTION;
            var DATA;

            fs.readFile('./con.data', 'utf8', (err, data) => {
                if (err) {
                    console.error(err)
                    return
                }

                data = data.split(/\r?\n/);

                IP_ADDRESS = data[0];
                USER = data[1];
                PASSWORD = data[2];
                DATABASE_NAME = data[3];

                fnCreateConnection();

                fnRunQuery('select * from Student', fnFillData);

                fnCloseConnection();
            });

            function fnCreateConnection() {
                // Add the credentials to access your database
                CONNECTION = mysql.createConnection({
                    host     : IP_ADDRESS,
                    user     : USER,
                    password : PASSWORD,
                    database : DATABASE_NAME
                });

                CONNECTION.connect();

            }

            function fnCloseConnection() {
                CONNECTION.end();
            }

            function fnRunQuery(strQuery, fncallback) {
                CONNECTION.query(strQuery, function(err, rows, fields) {
                  if (err) throw err;

                  fncallback(rows);
                });
            }

            function fnLog() {
                if(typeof(console) !== 'undefined') {
                    console.log.apply(console, arguments);
                }
            }

            function fnFillData(data) {
                var grid = $('#grid')[0];

                var item = `<tr>
                                <th>ID</th>
                                <th>First Name</th>
                                <th>Middle Name</th>
                                <th>Last Name</th>
                            </tr>`;
                grid.innerHTML += item;

                for (var i = 0; i < data.length; i++) {
                    // console.log(data[i]);
                    var id = data[i]["ID"];
                    var fname = data[i]["FName"];
                    var mname = data[i]["MName"];
                    var lname = data[i]["LName"];

                    item = `<tr>
                                <th>${id}</th>
                                <th>${fname}</th>
                                <th>${mname}</th>
                                <th>${lname}</th>
                            </tr>`;

                    grid.innerHTML += item;
                }
            }
        </script>
        <h1>Student Information</h1>
        <div class="table-container">
            <table id="grid">
            </table>
        </div>
    </body>
</html>
