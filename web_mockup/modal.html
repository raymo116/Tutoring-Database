<script type="text/javascript">
    $("#m_info_exit").click(function() {
        clearInfoModal(true);
    });

    function clearInfoModal(hide) {
        if(hide) $("#m_info").hide();
        $("#m_info-title").text("");
        $("#m_info-title-left").text("");
        $("#m_info-title-right").text("");
        $("#m_info-content-left").html("");
        $("#m_info-content-right").html("");
    }

    $("#m_login_exit").click(function() {
        clearloginModal(true);
    });

    $("#tutor").click(function() {
        alert("Logging in as a tutor");
        chooseTableLayout();
    });

    $("#tutee").click(function() {
        alert("Logging in as a tutee");
        chooseTutorLayout();
    });

    function chooseTableLayout() {
        $('#choose_tutor').hide();
        $('#tutor-login').hide();
        $('#num_pad').hide();
        $('#btn_select').hide();
        $('#choose-table').show();
        $('#table-select').show();

        var FIND_OPEN_TABLES = 'call sp_get_open_tables();';

        fnRunQuery(FIND_OPEN_TABLES, fnFillData, fnChooseTable, "open-tables");
    }

    function fnChooseTable(e) {
        if(e.hasClass("selected")) {
            $('#table-select').click(function() {
                    var table = e[0].innerText;
                    var d = getDateTime();
                    var TUTOR_IN = `call sp_tutor_in('${d}', ${STUDENT_ID}, ${table});`;

                    fnRunQuery(TUTOR_IN, function(...rest){
                        clearloginModal(true);
                        console.log(rest);
                        alert("You are checked in to tutor");
                    });
                });
        } else {
            $('#table-select').click(function() {
                    alert("You need to select a table");
                });
        }
    }

    function getDateTime() {
        return new Date().toISOString().slice(0, 19).replace('T', ' ');
    }

    function clearloginModal(hide) {
        if(hide) $("#m_login").hide();

        $('#num_pad').show();
        $('#choose_tutor').hide();
        $('#btn_select').hide();
        $('#tutor-login').hide();
        $('#choose-table').hide();

        $("#m_login-title").text("");
        $("#m_info-content").text("");

        STUDENT_ID = null;
        SELECTED_TUTOR_ID = null;
    }

    function chooseTutorLayout() {
        $('#num_pad').hide();
        $('#choose_tutor').show();
        $('#btn_select').show();
        $('#tutor-login').hide();
        $('#choose-table').hide();

        $("#m_login-title").text("Chose a tutor");
    }

    function tutorCheckinLayout() {
        $('#num_pad').hide();
        $('#choose_tutor').hide();
        $('#btn_select').hide();
        $('#tutor-login').show();
        $('#choose-table').hide();
    }

    $('#btn_select').click(function() {
        if (SELECTED_TUTOR_ID != null) {
            var CHECK_IN_STUDENT = `call sp_student_in(${SELECTED_TUTOR_ID}, ${STUDENT_ID}, null);`;
            console.log(CHECK_IN_STUDENT);
            fnRunQuery(CHECK_IN_STUDENT, function(...rest){
                if(rest[0][0]['Output'] === -1) {
                    alert("error");
                    console.log(rest);
                } else {
                    alert(`You have successfully logged in with ID# ${STUDENT_ID}.\nThis needs to be updated and replaced with something that's not ugly asf.`)
                    clearloginModal(true);
                }
            });
        } else alert('You need to select a tutor');
    });
</script>

<!-- Class/Tutor Modal -->
<div id="m_info" class="modal">

    <!-- Modal content -->
    <div class="modal-content">
        <span class="close" id="m_info_exit">&times;</span>
        <div class="modal-body">
            <h2 id="m_info-title"></h2>
            <div class="modal-content-box">
                <h3 id="m_info-title-left"></h3>
                <div id="m_info-content-left" class="table-container">

                </div>
            </div>
            <div class="modal-content-box">
                <h3 id="m_info-title-right"></h3>
                <div id="m_info-content-right" class="table-container">
                </div>

            </div>
        </div>
    </div>

</div>

<!-- Log-in Modal -->
<div id="m_login" class="modal">

    <!-- Modal content -->
    <div class="modal-content">
        <span class="close" id="m_login_exit">&times;</span>
        <div id="choose_tutor" class="modal-body">
            <h2 id="m_login-title"></h2>
            <div class="table-container" id="m_info-content">
            </div>
        </div>
        <button type="button" id="btn_select" name="btn_select" class="normal">Select</button>

        <div id="num_pad">
            <!-- Log in -->
            <h2>Manual Login</h2>
            <input type="number" id="id_login" name="id_login" value="">
            <br/>

            <button type="button" onclick="fnEnterNum(this);" name="one" class="white">1</button>
            <button type="button" onclick="fnEnterNum(this);"name="two" class="white">2</button>
            <button type="button" onclick="fnEnterNum(this);"name="three" class="white">3</button>
            <br/>
            <button type="button" onclick="fnEnterNum(this);"name="four" class="white">4</button>
            <button type="button" onclick="fnEnterNum(this);"name="five" class="white">5</button>
            <button type="button" onclick="fnEnterNum(this);"name="six" class="white">6</button>
            <br/>
            <button type="button" onclick="fnEnterNum(this);"name="seven" class="white">7</button>
            <button type="button" onclick="fnEnterNum(this);"name="eight" class="white">8</button>
            <button type="button" onclick="fnEnterNum(this);"name="nine" class="white">9</button>
            <br/>
            <button type="button" onclick="fnEnterNum(this);"name="clear" class="clear">X</button>
            <button type="button" onclick="fnEnterNum(this);"name="zero" class="white">0</button>
            <button type="button" onclick="fnEnterNum(this);"name="enter" class="enter">âœ“</button>
            <br/>
        </div>

        <div id="tutor-login">
            <h2>Logging in as...</h2>
            <button type="button" id="tutor" name="tutor" class="normal">Tutor</button>
            <br/>
            <button type="button" id="tutee" name="tutee" class="normal">Tutee</button>
        </div>

        <div id="choose-table">
            <h2>Choose an Open Table</h2>
            <div class="table-container" id="open-tables"></div>
            <br/>
            <!-- Need to impliment editing login times eventually -->
            <!-- <input type="datetime" id="select-time" name="select-time" value="">
            <br/> -->
            <button type="button" id="table-select" name="table-select" class="normal">Select</button>
        </div>
    </div>
    </div>
</div>
